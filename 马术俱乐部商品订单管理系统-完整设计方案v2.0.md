# é©¬æœ¯ä¿±ä¹éƒ¨å•†å“è®¢å•ç®¡ç†ç³»ç»Ÿ - å®Œæ•´è®¾è®¡æ–¹æ¡ˆ v2.0

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**é¡¹ç›®å®šä½**: åŸºäºç°æœ‰é©¬æœ¯ä¿±ä¹éƒ¨ç®¡ç†ç³»ç»Ÿçš„å…¨æ ˆå•†å“è®¢å•ç®¡ç†æ‰©å±•ï¼ŒåŒ…å«åå°ç®¡ç†ç³»ç»Ÿå’Œå¾®ä¿¡å°ç¨‹åº  
**æ ¸å¿ƒå˜åŒ–**: 
- è®¢å•ç”Ÿæˆå³åˆ›å»ºè¯¾è¡¨ï¼ˆå¾…ç¡®è®¤çŠ¶æ€ï¼‰
- é›†æˆå¾®ä¿¡æ”¯ä»˜ï¼Œå®Œæ•´æ”¯ä»˜æ•°æ®å­˜å‚¨
- æ”¯æŒé€€æ¬¾åæ•°æ®å›æ»š
- å°ç¨‹åºç«¯å®Œæ•´ä¸‹å•æµç¨‹
- åå°ç®¡ç†ç³»ç»Ÿè´Ÿè´£å•†å“ç®¡ç†å’Œè¿è¥

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„è®¾è®¡

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     é©¬æœ¯ä¿±ä¹éƒ¨å•†å“è®¢å•ç®¡ç†ç³»ç»Ÿ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  ğŸ“± å¾®ä¿¡å°ç¨‹åºç«¯              ğŸ–¥ï¸ åå°ç®¡ç†ç³»ç»Ÿ                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ å•†å“æµè§ˆé€‰æ‹©     â”‚         â”‚ å•†å“ç®¡ç†é…ç½®     â”‚               â”‚
â”‚  â”‚ è®¢å•åˆ›å»ºæ”¯ä»˜     â”‚  âŸ·     â”‚ è®¢å•ç®¡ç†æŸ¥çœ‹     â”‚               â”‚
â”‚  â”‚ è¯¾ç¨‹é¢„çº¦ç®¡ç†     â”‚         â”‚ è¯¾è¡¨ç®¡ç†ç¡®è®¤     â”‚               â”‚
â”‚  â”‚ ä¸ªäººä¸­å¿ƒ        â”‚         â”‚ æ•°æ®ç»Ÿè®¡åˆ†æ     â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚           â”‚                            â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    API æ¥å£å±‚                               â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚
â”‚  â”‚ â”‚ å°ç¨‹åºæ¥å£   â”‚ â”‚ ç®¡ç†åå°æ¥å£ â”‚ â”‚ å…¬å…±æœåŠ¡æ¥å£ â”‚          â”‚ â”‚
â”‚  â”‚ â”‚ /api/mini   â”‚ â”‚ /api/admin  â”‚ â”‚ /api/common â”‚          â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                            â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                   ä¸šåŠ¡æœåŠ¡å±‚                                â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚
â”‚  â”‚ â”‚ å•†å“æœåŠ¡     â”‚ â”‚ è®¢å•æœåŠ¡     â”‚ â”‚ æ”¯ä»˜æœåŠ¡     â”‚          â”‚ â”‚
â”‚  â”‚ â”‚ é¢„çº¦æœåŠ¡     â”‚ â”‚ è¯¾è¡¨æœåŠ¡     â”‚ â”‚ ä¼šå‘˜æœåŠ¡     â”‚          â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚           â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  æ•°æ®å­˜å‚¨å±‚                                 â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚
â”‚  â”‚ â”‚ MySQL ä¸»åº“   â”‚ â”‚ Redis ç¼“å­˜   â”‚ â”‚ æ–‡ä»¶å­˜å‚¨     â”‚          â”‚ â”‚
â”‚  â”‚ â”‚ ä¸šåŠ¡æ•°æ®     â”‚ â”‚ ä¼šè¯/ä¸´æ—¶    â”‚ â”‚ å›¾ç‰‡/æ–‡æ¡£    â”‚          â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  å¤–éƒ¨æœåŠ¡é›†æˆ                               â”‚ â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ â”‚
â”‚  â”‚ â”‚ å¾®ä¿¡æ”¯ä»˜API  â”‚ â”‚ å¾®ä¿¡å°ç¨‹åº   â”‚ â”‚ æ¶ˆæ¯æ¨é€     â”‚          â”‚ â”‚
â”‚  â”‚ â”‚ æ”¯ä»˜/é€€æ¬¾    â”‚ â”‚ ç™»å½•æˆæƒ     â”‚ â”‚ æ¨¡æ¿æ¶ˆæ¯     â”‚          â”‚ â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’° æ”¯ä»˜ç³»ç»Ÿè®¾è®¡

### æ”¯ä»˜æ•°æ®è¡¨ç»“æ„æ–°å¢

#### æ”¯ä»˜è®°å½•è¡¨ (m_payment_record)
```sql
CREATE TABLE `m_payment_record`
(
    `payment_id`        bigint                                  NOT NULL AUTO_INCREMENT COMMENT 'æ”¯ä»˜è®°å½•ID',
    `order_id`          bigint                                  NOT NULL COMMENT 'å…³è”è®¢å•ID',
    `payment_no`        varchar(64) COLLATE utf8mb4_general_ci  NOT NULL COMMENT 'æ”¯ä»˜å•å·ï¼ˆç³»ç»Ÿç”Ÿæˆï¼‰',
    `trade_no`          varchar(64) COLLATE utf8mb4_general_ci  NOT NULL DEFAULT '' COMMENT 'ç¬¬ä¸‰æ–¹äº¤æ˜“å·',
    `payment_method`    varchar(20) COLLATE utf8mb4_general_ci  NOT NULL COMMENT 'æ”¯ä»˜æ–¹å¼: wechat-å¾®ä¿¡æ”¯ä»˜',
    `payment_type`      tinyint                                 NOT NULL COMMENT 'æ”¯ä»˜ç±»å‹: 1-ä»˜æ¬¾ 2-é€€æ¬¾',
    `payment_amount`    decimal(10, 2)                          NOT NULL COMMENT 'æ”¯ä»˜é‡‘é¢',
    `payment_status`    tinyint                                 NOT NULL DEFAULT 1 COMMENT 'æ”¯ä»˜çŠ¶æ€: 1-å¾…æ”¯ä»˜ 2-æ”¯ä»˜ä¸­ 3-æ”¯ä»˜æˆåŠŸ 4-æ”¯ä»˜å¤±è´¥ 5-å·²å…³é—­',
    `prepay_id`         varchar(64) COLLATE utf8mb4_general_ci  NOT NULL DEFAULT '' COMMENT 'å¾®ä¿¡é¢„æ”¯ä»˜ID',
    `openid`            varchar(64) COLLATE utf8mb4_general_ci  NOT NULL DEFAULT '' COMMENT 'ç”¨æˆ·openid',
    `payment_time`      datetime                                         DEFAULT NULL COMMENT 'æ”¯ä»˜å®Œæˆæ—¶é—´',
    `notify_time`       datetime                                         DEFAULT NULL COMMENT 'é€šçŸ¥å›è°ƒæ—¶é—´',
    `callback_data`     text COLLATE utf8mb4_general_ci COMMENT 'æ”¯ä»˜å›è°ƒåŸå§‹æ•°æ®JSON',
    `refund_reason`     varchar(200) COLLATE utf8mb4_general_ci NOT NULL DEFAULT '' COMMENT 'é€€æ¬¾åŸå› ',
    `refund_amount`     decimal(10, 2)                          NOT NULL DEFAULT 0.00 COMMENT 'é€€æ¬¾é‡‘é¢',
    `refund_time`       datetime                                         DEFAULT NULL COMMENT 'é€€æ¬¾æ—¶é—´',
    `refund_status`     tinyint                                 NOT NULL DEFAULT 0 COMMENT 'é€€æ¬¾çŠ¶æ€: 0-æ— é€€æ¬¾ 1-é€€æ¬¾ä¸­ 2-é€€æ¬¾æˆåŠŸ 3-é€€æ¬¾å¤±è´¥',
    `expire_time`       datetime                                         DEFAULT NULL COMMENT 'æ”¯ä»˜è¿‡æœŸæ—¶é—´',
    `create_by`         varchar(50) COLLATE utf8mb4_general_ci  NOT NULL DEFAULT '' COMMENT 'åˆ›å»ºäºº',
    `create_time`       datetime                                NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_by`         varchar(50) COLLATE utf8mb4_general_ci  NOT NULL DEFAULT '' COMMENT 'æ›´æ–°äºº',
    `update_time`       datetime                                NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    PRIMARY KEY (`payment_id`),
    UNIQUE KEY `uk_payment_no` (`payment_no`),
    KEY                 `idx_order_id` (`order_id`),
    KEY                 `idx_trade_no` (`trade_no`),
    KEY                 `idx_payment_status` (`payment_status`),
    KEY                 `idx_create_time` (`create_time`),
    CONSTRAINT `fk_payment_order` FOREIGN KEY (`order_id`) REFERENCES `m_order` (`order_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='æ”¯ä»˜è®°å½•è¡¨';
```

#### æ”¯ä»˜æµæ°´è¡¨ (m_payment_flow)
```sql
CREATE TABLE `m_payment_flow`
(
    `flow_id`       bigint                                  NOT NULL AUTO_INCREMENT COMMENT 'æµæ°´ID',
    `payment_id`    bigint                                  NOT NULL COMMENT 'æ”¯ä»˜è®°å½•ID',
    `flow_type`     tinyint                                 NOT NULL COMMENT 'æµæ°´ç±»å‹: 1-åˆ›å»ºè®¢å• 2-å‘èµ·æ”¯ä»˜ 3-æ”¯ä»˜æˆåŠŸ 4-æ”¯ä»˜å¤±è´¥ 5-ç”³è¯·é€€æ¬¾ 6-é€€æ¬¾æˆåŠŸ',
    `flow_amount`   decimal(10, 2)                          NOT NULL DEFAULT 0.00 COMMENT 'æµæ°´é‡‘é¢',
    `flow_desc`     varchar(200) COLLATE utf8mb4_general_ci NOT NULL COMMENT 'æµæ°´æè¿°',
    `operator_id`   bigint                                  NOT NULL DEFAULT 0 COMMENT 'æ“ä½œäººID',
    `operator_type` tinyint                                 NOT NULL COMMENT 'æ“ä½œäººç±»å‹: 1-ä¼šå‘˜ 2-ç®¡ç†å‘˜ 3-ç³»ç»Ÿ',
    `flow_data`     text COLLATE utf8mb4_general_ci COMMENT 'æµæ°´æ‰©å±•æ•°æ®JSON',
    `create_time`   datetime                                NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    PRIMARY KEY (`flow_id`),
    KEY             `idx_payment_id` (`payment_id`),
    KEY             `idx_create_time` (`create_time`),
    CONSTRAINT `fk_flow_payment` FOREIGN KEY (`payment_id`) REFERENCES `m_payment_record` (`payment_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT='æ”¯ä»˜æµæ°´è¡¨';
```

### å¾®ä¿¡æ”¯ä»˜é›†æˆæ¶æ„

#### æ”¯ä»˜æµç¨‹æ—¶åºå›¾
```
å°ç¨‹åºç«¯          åç«¯API           å¾®ä¿¡æ”¯ä»˜           æ•°æ®åº“
    â”‚               â”‚                â”‚                â”‚
    â”‚â”€â”€åˆ›å»ºè®¢å•â”€â”€â”€â”€â†’â”‚                â”‚                â”‚
    â”‚               â”‚â”€â”€ä¿å­˜è®¢å•æ•°æ®â”€â”€â†’â”‚                â”‚
    â”‚               â”‚â”€â”€åˆ›å»ºæ”¯ä»˜è®°å½•â”€â”€â†’â”‚                â”‚
    â”‚               â”‚                â”‚                â”‚
    â”‚               â”‚â”€â”€ç»Ÿä¸€ä¸‹å•APIâ”€â”€â†’â”‚                â”‚
    â”‚               â”‚â†â”€â”€è¿”å›prepay_idâ”‚                â”‚
    â”‚â†â”€â”€è¿”å›æ”¯ä»˜å‚æ•°â”€â”€â”‚                â”‚                â”‚
    â”‚               â”‚                â”‚                â”‚
    â”‚â”€â”€è°ƒèµ·æ”¯ä»˜â”€â”€â”€â”€â†’â”‚                â”‚                â”‚
    â”‚               â”‚                â”‚â”€â”€ç”¨æˆ·æ”¯ä»˜â”€â”€â”€â”€â†’ â”‚
    â”‚               â”‚                â”‚                â”‚
    â”‚               â”‚â†â”€â”€æ”¯ä»˜å›è°ƒâ”€â”€â”€â”€â”€â”€â”‚                â”‚
    â”‚               â”‚â”€â”€æ›´æ–°æ”¯ä»˜çŠ¶æ€â”€â”€â†’â”‚                â”‚
    â”‚               â”‚â”€â”€æ›´æ–°è®¢å•çŠ¶æ€â”€â”€â†’â”‚                â”‚
    â”‚               â”‚â”€â”€ç”Ÿæˆè¯¾è¡¨è®°å½•â”€â”€â†’â”‚                â”‚
    â”‚               â”‚â”€â”€å‘é€é€šçŸ¥æ¶ˆæ¯â”€â”€â†’â”‚                â”‚
    â”‚               â”‚                â”‚                â”‚
    â”‚â†â”€â”€æ”¯ä»˜æˆåŠŸé€šçŸ¥â”€â”€â”‚                â”‚                â”‚
```

#### æ”¯ä»˜æœåŠ¡æ ¸å¿ƒä»£ç ç»“æ„
```javascript
// æ”¯ä»˜æœåŠ¡ç±»
class PaymentService {
  
  // åˆ›å»ºæ”¯ä»˜è®¢å•
  async createPayment(orderData) {
    // 1. éªŒè¯è®¢å•æ•°æ®
    // 2. ç”Ÿæˆæ”¯ä»˜è®°å½•
    // 3. è°ƒç”¨å¾®ä¿¡ç»Ÿä¸€ä¸‹å•
    // 4. è¿”å›æ”¯ä»˜å‚æ•°
  }
  
  // æ”¯ä»˜æˆåŠŸå›è°ƒå¤„ç†
  async handlePaymentSuccess(callbackData) {
    // 1. éªŒè¯å›è°ƒæ•°æ®
    // 2. æ›´æ–°æ”¯ä»˜çŠ¶æ€
    // 3. æ›´æ–°è®¢å•çŠ¶æ€
    // 4. è‡ªåŠ¨ç”Ÿæˆè¯¾è¡¨
    // 5. æ‰£å‡åº“å­˜
    // 6. å‘é€é€šçŸ¥
  }
  
  // ç”³è¯·é€€æ¬¾
  async applyRefund(paymentId, refundAmount, reason) {
    // 1. éªŒè¯é€€æ¬¾æ¡ä»¶
    // 2. è°ƒç”¨å¾®ä¿¡é€€æ¬¾API
    // 3. æ›´æ–°é€€æ¬¾çŠ¶æ€
    // 4. æ¢å¤ç›¸å…³æ•°æ®
  }
}
```

---

## ğŸ”„ ä¸šåŠ¡æµç¨‹é‡æ–°è®¾è®¡

### æ–°çš„æ ¸å¿ƒä¸šåŠ¡æµç¨‹

```
å°ç¨‹åºç«¯é€‰æ‹©å•†å“ â†’ é…ç½®å•†å“å‚æ•° â†’ é€‰æ‹©ä¸Šè¯¾æ—¶é—´ â†’ ç¡®è®¤è®¢å•ä¿¡æ¯ â†’ å‘èµ·å¾®ä¿¡æ”¯ä»˜
        â†“              â†“              â†“            â†“              â†“
     å•†å“ç±»å‹å±•ç¤º      åŠ¨æ€é…ç½®è¡¨å•     æ—¶é—´å†²çªæ£€æµ‹   ç”Ÿæˆå¾…ä»˜è®¢å•     åˆ›å»ºæ”¯ä»˜è®°å½•
        â†“              â†“              â†“            â†“              â†“
     æ”¯ä»˜æˆåŠŸå›è°ƒ â†’ æ›´æ–°è®¢å•çŠ¶æ€ â†’ è‡ªåŠ¨ç”Ÿæˆè¯¾è¡¨ â†’ æ‰£å‡ç›¸å…³åº“å­˜ â†’ æ¨é€æ¶ˆæ¯é€šçŸ¥
        â†“              â†“              â†“            â†“              â†“
     æ”¯ä»˜æµæ°´è®°å½•      è®¢å•çŠ¶æ€:å·²ä»˜   è¯¾è¡¨çŠ¶æ€:å¾…ç¡®è®¤   åº“å­˜å®æ—¶æ›´æ–°    å¾®ä¿¡æ¨¡æ¿æ¶ˆæ¯
```

### è¯¦ç»†ä¸šåŠ¡çŠ¶æ€æµè½¬å›¾

```
è®¢å•çŠ¶æ€æµè½¬:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    æ”¯ä»˜æˆåŠŸ    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    åå°ç¡®è®¤    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1-å¾…æ”¯ä»˜    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚  2-å·²æ”¯ä»˜    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚  3-å·²ç¡®è®¤    â”‚
â”‚  (30åˆ†é’Ÿ)   â”‚              â”‚             â”‚              â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                            â”‚                            â”‚
       â”‚æ”¯ä»˜è¶…æ—¶                      â”‚ç”³è¯·é€€æ¬¾                      â”‚è¯¾ç¨‹å®Œæˆ
       â†“                            â†“                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4-å·²å–æ¶ˆ    â”‚              â”‚  5-å·²é€€æ¬¾    â”‚              â”‚  6-å·²å®Œæˆ    â”‚
â”‚             â”‚              â”‚             â”‚              â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¯¾è¡¨çŠ¶æ€æµè½¬:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    åå°ç¡®è®¤    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    å­¦å‘˜åˆ°åº—    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1-å¾…ç¡®è®¤    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚  2-å·²ç¡®è®¤    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚  3-è¿›è¡Œä¸­    â”‚
â”‚             â”‚              â”‚             â”‚              â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                            â”‚                            â”‚
       â”‚è®¢å•é€€æ¬¾                      â”‚å–æ¶ˆè¯¾ç¨‹                      â”‚è¯¾ç¨‹ç»“æŸ
       â†“                            â†“                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4-å·²å–æ¶ˆ    â”‚              â”‚  4-å·²å–æ¶ˆ    â”‚              â”‚  5-å·²å®Œæˆ    â”‚
â”‚             â”‚              â”‚             â”‚              â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ”¯ä»˜çŠ¶æ€æµè½¬:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ç»Ÿä¸€ä¸‹å•    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    æ”¯ä»˜æˆåŠŸ    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1-å¾…æ”¯ä»˜    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚  2-æ”¯ä»˜ä¸­    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’   â”‚  3-æ”¯ä»˜æˆåŠŸ  â”‚
â”‚             â”‚              â”‚             â”‚              â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                            â”‚                            â”‚
       â”‚è®¢å•è¶…æ—¶                      â”‚æ”¯ä»˜å¤±è´¥                      â”‚ç”³è¯·é€€æ¬¾
       â†“                            â†“                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5-å·²å…³é—­    â”‚              â”‚  4-æ”¯ä»˜å¤±è´¥  â”‚              â”‚é€€æ¬¾å¤„ç†çŠ¶æ€   â”‚
â”‚             â”‚              â”‚             â”‚              â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“± å°ç¨‹åºç«¯è®¾è®¡

### å°ç¨‹åºé¡µé¢æ¶æ„

```
å°ç¨‹åºé¡µé¢ç»“æ„:
â”œâ”€â”€ é¦–é¡µ (index)
â”‚   â”œâ”€â”€ è½®æ’­å›¾å±•ç¤º
â”‚   â”œâ”€â”€ å•†å“åˆ†ç±»å…¥å£
â”‚   â””â”€â”€ æ¨èå•†å“åˆ—è¡¨
â”‚
â”œâ”€â”€ å•†å“æ¨¡å—
â”‚   â”œâ”€â”€ å•†å“åˆ—è¡¨é¡µ (product/list)
â”‚   â”œâ”€â”€ å•†å“è¯¦æƒ…é¡µ (product/detail)
â”‚   â”œâ”€â”€ è¯¾ç¨‹é…ç½®é¡µ (product/course-config)
â”‚   â”œâ”€â”€ è¯¾æ—¶åŒ…é…ç½®é¡µ (product/package-config)
â”‚   â””â”€â”€ æ´»åŠ¨è¯¦æƒ…é¡µ (product/activity-detail)
â”‚
â”œâ”€â”€ è®¢å•æ¨¡å—
â”‚   â”œâ”€â”€ è®¢å•ç¡®è®¤é¡µ (order/confirm)
â”‚   â”œâ”€â”€ æ”¯ä»˜é¡µé¢ (order/payment)
â”‚   â”œâ”€â”€ è®¢å•åˆ—è¡¨é¡µ (order/list)
â”‚   â””â”€â”€ è®¢å•è¯¦æƒ…é¡µ (order/detail)
â”‚
â”œâ”€â”€ é¢„çº¦æ¨¡å—
â”‚   â”œâ”€â”€ æ—¶é—´é€‰æ‹©é¡µ (booking/time-select)
â”‚   â”œâ”€â”€ æ•™ç»ƒé€‰æ‹©é¡µ (booking/coach-select)
â”‚   â”œâ”€â”€ æˆ‘çš„é¢„çº¦é¡µ (booking/my-list)
â”‚   â””â”€â”€ é¢„çº¦è¯¦æƒ…é¡µ (booking/detail)
â”‚
â””â”€â”€ ä¸ªäººä¸­å¿ƒ
    â”œâ”€â”€ ä¸ªäººä¿¡æ¯é¡µ (user/profile)
    â”œâ”€â”€ æˆ‘çš„è¯¾æ—¶åŒ… (user/packages)
    â”œâ”€â”€ è¯¾ç¨‹å†å² (user/lessons)
    â””â”€â”€ è®¾ç½®é¡µé¢ (user/settings)
```

### å°ç¨‹åºå…³é”®é¡µé¢è®¾è®¡

#### 1. å•†å“è¯¦æƒ…é¡µè®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† å•†å“è¯¦æƒ…                                    åˆ†äº« â‹¯        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚     â”‚                                                 â”‚     â”‚
â”‚     â”‚              å•†å“è½®æ’­å›¾                          â”‚     â”‚
â”‚     â”‚                                                 â”‚     â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                             â”‚
â”‚ ğŸ“š ä½“éªŒè¯¾ç¨‹                                    Â¥200        â”‚
â”‚ ğŸ·ï¸ é€‚åˆæ–°æ‰‹ä½“éªŒ | æ•™ç»ƒä¸€å¯¹ä¸€æŒ‡å¯¼                             â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€å•†å“ç±»å‹â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ â¦¿ å•äººè¯¾    â—‹ å¤šäººè¯¾                                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€æ—¶é•¿è®¾ç½®â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ• 60åˆ†é’Ÿ | ğŸ‡ 1.0éæ—¶ | ğŸ‘¥ æœ€å¤š1äºº                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€ä»·æ ¼æ˜ç»†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ æ•™ç»ƒè´¹: Â¥150  é©¬åŒ¹è´¹: Â¥50  åˆè®¡: Â¥200                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€å¯é€‰æ•™ç»ƒâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ‘¨â€ğŸ« ææ•™ç»ƒ(æ¨è) ğŸ‘¨â€ğŸ« ç‹æ•™ç»ƒ ğŸ‘¨â€ğŸ« å¼ æ•™ç»ƒ                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚ [                    ç«‹å³é¢„çº¦                              ] â”‚
â”‚ [                    åŠ å…¥è´­ç‰©è½¦                            ] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. è®¢å•ç¡®è®¤é¡µè®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† ç¡®è®¤è®¢å•                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ ğŸ“ ä¸Šè¯¾åœ°å€                                                 â”‚
â”‚ æµ·æ·€åŒºé©¬æœ¯ä¿±ä¹éƒ¨ | ğŸ“ 010-12345678                         â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€è¯¾ç¨‹ä¿¡æ¯â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“š ä½“éªŒè¯¾ç¨‹                                  Â¥200       â”‚ â”‚
â”‚ â”‚ ğŸ‘¨â€ğŸ« ææ•™ç»ƒ | ğŸ• 2024-08-20 14:00-15:00              â”‚ â”‚
â”‚ â”‚ ğŸ‡ å•äººè¯¾ | 60åˆ†é’Ÿ | 1.0éæ—¶                           â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚ ğŸ‘¤ å­¦å‘˜ä¿¡æ¯                                                â”‚
â”‚ å¼ å°æ˜ | ğŸ“ 138****1234                                   â”‚
â”‚                                                             â”‚
â”‚ ğŸ’° è´¹ç”¨æ˜ç»†                                                â”‚
â”‚ è¯¾ç¨‹è´¹ç”¨: Â¥200                                             â”‚
â”‚ ä¼˜æƒ é‡‘é¢: -Â¥0                                              â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚
â”‚ å®ä»˜é‡‘é¢: Â¥200                                             â”‚
â”‚                                                             â”‚
â”‚ ğŸ“ å¤‡æ³¨ä¿¡æ¯                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ è¯·è¾“å…¥ç‰¹æ®Šéœ€æ±‚æˆ–å¤‡æ³¨...                                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚ [                   ç¡®è®¤æ”¯ä»˜ Â¥200                         ] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3. æˆ‘çš„é¢„çº¦é¡µè®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æˆ‘çš„é¢„çº¦                    ğŸ“… æ—¥å†è§†å›¾ ğŸ“‹ åˆ—è¡¨è§†å›¾         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ ğŸ” æœç´¢è¯¾ç¨‹...                        [å…¨éƒ¨â–¼] [ç­›é€‰]       â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€ä»Šæ—¥è¯¾ç¨‹â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸŸ¢ 14:00-15:00  ä½“éªŒè¯¾ç¨‹                               â”‚ â”‚
â”‚ â”‚    ğŸ‘¨â€ğŸ« ææ•™ç»ƒ  ğŸ‡ é©¬001  ğŸ“ åœºåœ°A                     â”‚ â”‚
â”‚ â”‚    [ç­¾åˆ°] [æŸ¥çœ‹è¯¦æƒ…] [å–æ¶ˆ]                            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€æ˜æ—¥è¯¾ç¨‹â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸŸ¡ 09:00-10:00  åŸºç¡€è¯¾ç¨‹                  å¾…ç¡®è®¤        â”‚ â”‚
â”‚ â”‚    ğŸ‘¨â€ğŸ« ç‹æ•™ç»ƒ  ğŸ‡ å¾…åˆ†é…  ğŸ“ å¾…åˆ†é…                   â”‚ â”‚
â”‚ â”‚    [æŸ¥çœ‹è¯¦æƒ…] [ä¿®æ”¹] [å–æ¶ˆ]                            â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚ â”Œâ”€ä¸‹å‘¨è¯¾ç¨‹â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ”µ 2024-08-25 10:00-11:00  è¿›é˜¶è¯¾ç¨‹                   â”‚ â”‚
â”‚ â”‚    ğŸ‘¨â€ğŸ« å¼ æ•™ç»ƒ  ğŸ‡ é©¬003  ğŸ“ åœºåœ°B                     â”‚ â”‚
â”‚ â”‚    [æŸ¥çœ‹è¯¦æƒ…] [ä¿®æ”¹]                                   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                             â”‚
â”‚ ğŸ“Š æœ¬æœˆç»Ÿè®¡: å·²ä¸Š8èŠ‚ | å‰©ä½™è¯¾æ—¶åŒ…: 12èŠ‚                     â”‚
â”‚                                                             â”‚
â”‚ [                    é¢„çº¦æ–°è¯¾ç¨‹                            ] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å°ç¨‹åºAPIæ¥å£è®¾è®¡

#### æ¥å£åˆ†å±‚æ¶æ„
```
/api/mini/                          // å°ç¨‹åºä¸“ç”¨æ¥å£å‰ç¼€
â”œâ”€â”€ auth/                          // æˆæƒç›¸å…³
â”‚   â”œâ”€â”€ POST /login                // å¾®ä¿¡ç™»å½•
â”‚   â”œâ”€â”€ POST /refresh              // åˆ·æ–°token
â”‚   â””â”€â”€ POST /logout               // é€€å‡ºç™»å½•
â”‚
â”œâ”€â”€ product/                       // å•†å“ç›¸å…³
â”‚   â”œâ”€â”€ GET /list                  // å•†å“åˆ—è¡¨
â”‚   â”œâ”€â”€ GET /{id}                  // å•†å“è¯¦æƒ…
â”‚   â”œâ”€â”€ GET /{id}/coaches          // å•†å“å¯é€‰æ•™ç»ƒ
â”‚   â””â”€â”€ GET /{id}/config           // å•†å“é…ç½®é€‰é¡¹
â”‚
â”œâ”€â”€ order/                         // è®¢å•ç›¸å…³
â”‚   â”œâ”€â”€ POST /create               // åˆ›å»ºè®¢å•
â”‚   â”œâ”€â”€ GET /list                  // è®¢å•åˆ—è¡¨
â”‚   â”œâ”€â”€ GET /{id}                  // è®¢å•è¯¦æƒ…
â”‚   â”œâ”€â”€ POST /{id}/cancel          // å–æ¶ˆè®¢å•
â”‚   â””â”€â”€ POST /{id}/refund          // ç”³è¯·é€€æ¬¾
â”‚
â”œâ”€â”€ payment/                       // æ”¯ä»˜ç›¸å…³
â”‚   â”œâ”€â”€ POST /create               // åˆ›å»ºæ”¯ä»˜
â”‚   â”œâ”€â”€ POST /notify               // æ”¯ä»˜å›è°ƒ
â”‚   â”œâ”€â”€ GET /{id}/status           // æ”¯ä»˜çŠ¶æ€
â”‚   â””â”€â”€ POST /{id}/refund          // ç”³è¯·é€€æ¬¾
â”‚
â”œâ”€â”€ booking/                       // é¢„çº¦ç›¸å…³
â”‚   â”œâ”€â”€ GET /list                  // æˆ‘çš„é¢„çº¦
â”‚   â”œâ”€â”€ GET /{id}                  // é¢„çº¦è¯¦æƒ…
â”‚   â”œâ”€â”€ POST /{id}/checkin         // ç­¾åˆ°
â”‚   â”œâ”€â”€ PUT /{id}/modify           // ä¿®æ”¹é¢„çº¦
â”‚   â””â”€â”€ POST /{id}/cancel          // å–æ¶ˆé¢„çº¦
â”‚
â”œâ”€â”€ schedule/                      // è¯¾è¡¨ç›¸å…³
â”‚   â”œâ”€â”€ GET /available-times       // å¯é¢„çº¦æ—¶é—´
â”‚   â”œâ”€â”€ GET /coach-schedule        // æ•™ç»ƒè¯¾è¡¨
â”‚   â””â”€â”€ POST /conflict-check       // å†²çªæ£€æµ‹
â”‚
â””â”€â”€ user/                         // ç”¨æˆ·ç›¸å…³
    â”œâ”€â”€ GET /profile              // ä¸ªäººä¿¡æ¯
    â”œâ”€â”€ PUT /profile              // æ›´æ–°ä¿¡æ¯
    â”œâ”€â”€ GET /packages             // æˆ‘çš„è¯¾æ—¶åŒ…
    â””â”€â”€ GET /lessons              // è¯¾ç¨‹å†å²
```

---

## ğŸ–¥ï¸ åå°ç®¡ç†ç³»ç»Ÿè®¾è®¡

### åå°ç³»ç»ŸåŠŸèƒ½æ¶æ„

```
åå°ç®¡ç†ç³»ç»ŸåŠŸèƒ½æ¨¡å—:
â”œâ”€â”€ ğŸª ä¿±ä¹éƒ¨ç®¡ç†
â”‚   â”œâ”€â”€ åŸºæœ¬ä¿¡æ¯è®¾ç½®
â”‚   â”œâ”€â”€ è¥ä¸šæ—¶é—´é…ç½®
â”‚   â””â”€â”€ è½®æ’­å›¾ç®¡ç†
â”‚
â”œâ”€â”€ ğŸ›ï¸ å•†å“ç®¡ç†
â”‚   â”œâ”€â”€ å•†å“åˆ—è¡¨ç®¡ç†
â”‚   â”œâ”€â”€ å•†å“åˆ›å»ºé…ç½®
â”‚   â”œâ”€â”€ ä»·æ ¼ç­–ç•¥ç®¡ç†
â”‚   â””â”€â”€ åº“å­˜ç›‘æ§
â”‚
â”œâ”€â”€ ğŸ§¾ è®¢å•ç®¡ç†
â”‚   â”œâ”€â”€ è®¢å•åˆ—è¡¨æŸ¥è¯¢
â”‚   â”œâ”€â”€ è®¢å•è¯¦æƒ…æŸ¥çœ‹
â”‚   â”œâ”€â”€ é€€æ¬¾å¤„ç†
â”‚   â””â”€â”€ è®¢å•ç»Ÿè®¡
â”‚
â”œâ”€â”€ ğŸ“… è¯¾è¡¨ç®¡ç†
â”‚   â”œâ”€â”€ è¯¾è¡¨æ€»è§ˆ (æ—¥/å‘¨/æœˆè§†å›¾)
â”‚   â”œâ”€â”€ è¯¾ç¨‹ç¡®è®¤/è°ƒæ•´
â”‚   â”œâ”€â”€ èµ„æºå†²çªæ£€æµ‹
â”‚   â””â”€â”€ æ‰¹é‡æ“ä½œ
â”‚
â”œâ”€â”€ ğŸ‘¨â€ğŸ« æ•™ç»ƒç®¡ç†
â”‚   â”œâ”€â”€ æ•™ç»ƒæ¡£æœŸè®¾ç½®
â”‚   â”œâ”€â”€ è¯·å‡ç®¡ç†
â”‚   â”œâ”€â”€ å·¥ä½œé‡ç»Ÿè®¡
â”‚   â””â”€â”€ æ”¶å…¥åˆ†æ
â”‚
â”œâ”€â”€ ğŸ é©¬åŒ¹ç®¡ç†
â”‚   â”œâ”€â”€ é©¬åŒ¹æ¡£æœŸç®¡ç†
â”‚   â”œâ”€â”€ å¥åº·çŠ¶æ€ç›‘æ§
â”‚   â”œâ”€â”€ ä½¿ç”¨ç»Ÿè®¡
â”‚   â””â”€â”€ ç»´æŠ¤æé†’
â”‚
â”œâ”€â”€ ğŸ‘¥ ä¼šå‘˜ç®¡ç†
â”‚   â”œâ”€â”€ ä¼šå‘˜ä¿¡æ¯æŸ¥çœ‹
â”‚   â”œâ”€â”€ è¯¾æ—¶åŒ…ç®¡ç†
â”‚   â”œâ”€â”€ æ¶ˆè´¹è®°å½•
â”‚   â””â”€â”€ æ´»è·ƒåº¦åˆ†æ
â”‚
â”œâ”€â”€ ğŸ’° è´¢åŠ¡ç®¡ç†
â”‚   â”œâ”€â”€ æ”¶å…¥ç»Ÿè®¡æŠ¥è¡¨
â”‚   â”œâ”€â”€ æ”¯ä»˜æµæ°´æŸ¥è¯¢
â”‚   â”œâ”€â”€ é€€æ¬¾è®°å½•
â”‚   â””â”€â”€ å¯¹è´¦ç®¡ç†
â”‚
â””â”€â”€ ğŸ“Š æ•°æ®åˆ†æ
    â”œâ”€â”€ è¿è¥æ•°æ®å¤§å±
    â”œâ”€â”€ è¶‹åŠ¿åˆ†ææŠ¥å‘Š
    â”œâ”€â”€ å®¢æˆ·è¡Œä¸ºåˆ†æ
    â””â”€â”€ å†³ç­–æ”¯æŒç³»ç»Ÿ
```

### å…³é”®åå°é¡µé¢è®¾è®¡

#### 1. è¯¾è¡¨ç®¡ç†ä¸»é¡µé¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“… è¯¾è¡¨ç®¡ç†                [æ—¥è§†å›¾] [å‘¨è§†å›¾] [æœˆè§†å›¾] [æ–°å¢è¯¾ç¨‹]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç­›é€‰æ¡ä»¶ï¼š                                                      â”‚
â”‚ ğŸ“… [2024-08-20] ğŸ‘¨â€ğŸ« [å…¨éƒ¨æ•™ç»ƒâ–¼] ğŸ [å…¨éƒ¨é©¬åŒ¹â–¼] ğŸ“ [å…¨éƒ¨åœºåœ°â–¼]  â”‚
â”‚ ğŸ“‹ [å…¨éƒ¨çŠ¶æ€â–¼] ğŸ” [æœç´¢å­¦å‘˜/è®¢å•å·]                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                     2024å¹´8æœˆ20æ—¥ å‘¨äºŒè¯¾è¡¨                       â”‚
â”‚                                                                 â”‚
â”‚  æ—¶é—´   â”‚ ææ•™ç»ƒ   â”‚ ç‹æ•™ç»ƒ   â”‚ å¼ æ•™ç»ƒ   â”‚ åœºåœ°A   â”‚ åœºåœ°B   â”‚ æ“ä½œ  â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚09:00   â”‚ğŸŸ¡å¾…ç¡®è®¤  â”‚         â”‚ğŸŸ¢å·²ç¡®è®¤  â”‚ å ç”¨    â”‚ ç©ºé—²    â”‚[æ‰¹é‡] â”‚
â”‚-10:00  â”‚å¼ å°æ˜    â”‚         â”‚æå°çº¢    â”‚ é©¬001   â”‚         â”‚[ç¡®è®¤] â”‚
â”‚        â”‚ä½“éªŒè¯¾    â”‚         â”‚åŸºç¡€è¯¾    â”‚         â”‚         â”‚      â”‚
â”‚        â”‚Â¥200      â”‚         â”‚Â¥300      â”‚         â”‚         â”‚      â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚10:00   â”‚         â”‚ğŸ”µè¿›è¡Œä¸­  â”‚         â”‚         â”‚ å ç”¨    â”‚[æŸ¥çœ‹] â”‚
â”‚-11:00  â”‚         â”‚ç‹å°åˆš    â”‚         â”‚         â”‚ é©¬002   â”‚[è°ƒæ•´] â”‚
â”‚        â”‚         â”‚è¿›é˜¶è¯¾    â”‚         â”‚         â”‚         â”‚      â”‚
â”‚        â”‚         â”‚Â¥400      â”‚         â”‚         â”‚         â”‚      â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¤
â”‚14:00   â”‚ğŸŸ¢å·²ç¡®è®¤  â”‚         â”‚ğŸŸ¡å¾…ç¡®è®¤  â”‚ å ç”¨    â”‚ å ç”¨    â”‚[è¯¦æƒ…] â”‚
â”‚-15:00  â”‚èµµå°å    â”‚         â”‚æ–°å­¦å‘˜    â”‚ é©¬003   â”‚ é©¬001   â”‚[ç¼–è¾‘] â”‚
â”‚        â”‚é«˜çº§è¯¾    â”‚         â”‚ä½“éªŒè¯¾    â”‚         â”‚         â”‚      â”‚
â”‚        â”‚Â¥500      â”‚         â”‚Â¥200      â”‚         â”‚         â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ ğŸ“Š ä»Šæ—¥ç»Ÿè®¡: æ€»è¯¾ç¨‹ 8èŠ‚ | å·²ç¡®è®¤ 5èŠ‚ | å¾…ç¡®è®¤ 3èŠ‚ | å®Œæˆç‡ 62.5%  â”‚
â”‚ ğŸ’° ä»Šæ—¥æ”¶å…¥: Â¥2,400 | å¾…ç¡®è®¤æ”¶å…¥: Â¥900                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2. å•†å“é…ç½®é¡µé¢ï¼ˆæ™ºèƒ½è¡¨å•ï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–°å¢å•†å“                                              [ä¿å­˜] [å–æ¶ˆ] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‹ åŸºç¡€ä¿¡æ¯                                                     â”‚
â”‚ å•†å“åç§°: [________________] å•†å“ç¼–ç : [__________]              â”‚
â”‚ å•†å“ç±»å‹: â¦¿è¯¾ç¨‹ â—‹è¯¾æ—¶åŒ… â—‹æ´»åŠ¨                                   â”‚
â”‚ å•†å“æè¿°: [_________________________________________________]  â”‚
â”‚                                                                 â”‚
â”‚ ğŸ–¼ï¸ å•†å“å›¾ç‰‡: [ä¸Šä¼ å›¾ç‰‡] [é¢„è§ˆ]                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  ğŸ“·      ğŸ“·      ğŸ“·                                       â”‚ â”‚
â”‚ â”‚ å›¾ç‰‡1    å›¾ç‰‡2    å›¾ç‰‡3    [+ æ·»åŠ å›¾ç‰‡]                    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚                                                                 â”‚
â”‚ ğŸ“ è¯¾ç¨‹é…ç½® (æ ¹æ®é€‰æ‹©çš„å•†å“ç±»å‹è‡ªåŠ¨æ˜¾ç¤º)                         â”‚
â”‚                                                                 â”‚
â”‚ è¯¾ç¨‹åˆ†ç±»: â¦¿å•äººè¯¾ â—‹å¤šäººè¯¾                                       â”‚
â”‚ æ—¶é•¿è®¾ç½®: [60] åˆ†é’Ÿ  éæ—¶: [1.0]  æœ€å¤§äººæ•°: [1]                â”‚
â”‚                                                                 â”‚
â”‚ ğŸ’° ä»·æ ¼é…ç½®:                                                   â”‚
â”‚ æ•™ç»ƒè´¹: [150] å…ƒ  é©¬åŒ¹è´¹: [50] å…ƒ                              â”‚
â”‚ â†’ åŸºç¡€å•ä»·: 200 å…ƒ (è‡ªåŠ¨è®¡ç®—)                                   â”‚
â”‚                                                                 â”‚
â”‚ ğŸ‘¨â€ğŸ« å¯é€‰æ•™ç»ƒ: â–¡ ææ•™ç»ƒ â˜‘ ç‹æ•™ç»ƒ â˜‘ å¼ æ•™ç»ƒ                      â”‚
â”‚ é»˜è®¤æ•™ç»ƒ: [ç‹æ•™ç»ƒâ–¼]                                             â”‚
â”‚                                                                 â”‚
â”‚ â”Œâ”€å¤šäººè¯¾ä»·æ ¼é…ç½®â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“Š æŒ‰äººæ•°é˜¶æ¢¯å®šä»·:                                          â”‚ â”‚
â”‚ â”‚ 2äºº: [180/äºº] 3äºº: [160/äºº] 4äºº: [150/äºº] 5äºº: [140/äºº]     â”‚ â”‚
â”‚ â”‚                                                            â”‚ â”‚
â”‚ â”‚ ğŸ‘¨â€ğŸ« æ•™ç»ƒå·®å¼‚åŒ–å®šä»·:                                        â”‚ â”‚
â”‚ â”‚ ææ•™ç»ƒ: +20å…ƒ | ç‹æ•™ç»ƒ: æ ‡å‡†ä»· | å¼ æ•™ç»ƒ: +10å…ƒ                â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚ âš™ï¸ é«˜çº§è®¾ç½®:                                                   â”‚
â”‚ æ”¯æŒåˆ°åº—è°ƒä»·: â˜‘ æ˜¯ â—‹ å¦                                        â”‚
â”‚ æå‰é¢„çº¦æ—¶é—´: [24] å°æ—¶                                         â”‚
â”‚ å–æ¶ˆè¯¾ç¨‹è§„åˆ™: [è¯¾å‰24å°æ—¶å¯å…è´¹å–æ¶ˆ]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3. è®¢å•ç®¡ç†é¡µé¢
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ è®¢å•ç®¡ç†                                      [å¯¼å‡ºExcel] [æ–°å¢] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç­›é€‰æ¡ä»¶ï¼š                                                      â”‚
â”‚ ğŸ“… [ä»Šæ—¥â–¼] ğŸ’° [å…¨éƒ¨çŠ¶æ€â–¼] ğŸ›ï¸ [å•†å“ç±»å‹â–¼] ğŸ‘¤ [ä¼šå‘˜æœç´¢______]    â”‚
â”‚ ğŸ’³ [æ”¯ä»˜æ–¹å¼â–¼] ğŸ” [è®¢å•å·æœç´¢______] [æœç´¢] [é‡ç½®]               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚âœ“â”‚è®¢å•å· â”‚ ä¸‹å•æ—¶é—´ â”‚ ä¼šå‘˜ â”‚ å•†å“ â”‚ é‡‘é¢ â”‚ æ”¯ä»˜ â”‚ çŠ¶æ€ â”‚ æ“ä½œ   â”‚ â”‚
â”‚ â”œâ”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚â–¡â”‚O2024082â”‚14:32:18 â”‚å¼ å°æ˜ â”‚ä½“éªŒè¯¾â”‚ Â¥200â”‚å¾®ä¿¡ä»˜â”‚ğŸŸ¢å·²ä»˜â”‚æŸ¥çœ‹|é€€æ¬¾â”‚ â”‚
â”‚ â”‚ â”‚0001   â”‚         â”‚13812 â”‚60min â”‚     â”‚14:33 â”‚     â”‚        â”‚ â”‚
â”‚ â”œâ”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚â–¡â”‚O2024082â”‚14:28:45 â”‚æå°çº¢ â”‚è¯¾æ—¶åŒ…â”‚Â¥2000â”‚å¾®ä¿¡ä»˜â”‚ğŸŸ¡å¾…ç¡®â”‚ç¡®è®¤|è¯¦æƒ…â”‚ â”‚
â”‚ â”‚ â”‚0002   â”‚         â”‚13823 â”‚10èŠ‚è¯¾â”‚     â”‚14:30 â”‚è®¤   â”‚        â”‚ â”‚
â”‚ â”œâ”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚â–¡â”‚O2024082â”‚14:15:22 â”‚ç‹å°åˆš â”‚æ´»åŠ¨  â”‚ Â¥300â”‚å¾…æ”¯ä»˜â”‚ğŸ”´è¶…æ—¶â”‚æŸ¥çœ‹|å…³é—­â”‚ â”‚
â”‚ â”‚ â”‚0003   â”‚         â”‚13834 â”‚æ˜¥æ¸¸  â”‚     â”‚      â”‚     â”‚        â”‚ â”‚
â”‚ â””â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â”‚ ğŸ“Š ç»Ÿè®¡ä¿¡æ¯:                                                   â”‚
â”‚ ğŸ“ˆ ä»Šæ—¥è®¢å•: 28å• | ğŸ’° ä»Šæ—¥æ”¶å…¥: Â¥8,600 | âœ… æ”¯ä»˜æˆåŠŸç‡: 92.3%  â”‚
â”‚ ğŸ”„ å¾…å¤„ç†: 3å• | â° è¶…æ—¶è®¢å•: 1å• | ğŸ“ éœ€è¦å›è®¿: 2å•            â”‚
â”‚                                                                 â”‚
â”‚ é¡µç : [ä¸Šé¡µ] 1 2 3 ... 10 [ä¸‹é¡µ] å…± 245 æ¡è®°å½•                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”§ æŠ€æœ¯å®ç°ç»†èŠ‚

### æ”¯ä»˜å®‰å…¨è®¾è®¡

#### 1. ç­¾åéªŒè¯æœºåˆ¶
```javascript
// æ”¯ä»˜å›è°ƒç­¾åéªŒè¯
function verifyWechatSignature(data, signature) {
  const stringA = Object.keys(data)
    .filter(key => data[key] !== '' && key !== 'sign')
    .sort()
    .map(key => `${key}=${data[key]}`)
    .join('&');
  
  const stringSignTemp = `${stringA}&key=${API_KEY}`;
  const hash = crypto.createHash('md5').update(stringSignTemp).digest('hex');
  
  return hash.toUpperCase() === signature;
}
```

#### 2. å¹‚ç­‰æ€§ä¿è¯
```javascript
// æ”¯ä»˜å¹‚ç­‰æ€§æ§åˆ¶
class PaymentIdempotency {
  async processPayment(orderNo, paymentData) {
    const lockKey = `payment:lock:${orderNo}`;
    const lock = await redis.set(lockKey, '1', 'PX', 30000, 'NX');
    
    if (!lock) {
      throw new Error('æ”¯ä»˜æ­£åœ¨å¤„ç†ä¸­ï¼Œè¯·å‹¿é‡å¤æ“ä½œ');
    }
    
    try {
      // æ£€æŸ¥æ˜¯å¦å·²æ”¯ä»˜
      const existingPayment = await this.getPaymentByOrderNo(orderNo);
      if (existingPayment && existingPayment.status === 'SUCCESS') {
        return existingPayment;
      }
      
      // å¤„ç†æ”¯ä»˜é€»è¾‘
      return await this.doPayment(paymentData);
    } finally {
      await redis.del(lockKey);
    }
  }
}
```

### æ•°æ®ä¸€è‡´æ€§ä¿è¯

#### 1. åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†
```javascript
// æ”¯ä»˜æˆåŠŸåçš„æ•°æ®æ›´æ–°äº‹åŠ¡
async function handlePaymentSuccess(paymentData) {
  const transaction = await sequelize.transaction();
  
  try {
    // 1. æ›´æ–°æ”¯ä»˜çŠ¶æ€
    await PaymentRecord.update({
      payment_status: 3, // æ”¯ä»˜æˆåŠŸ
      payment_time: new Date(),
      trade_no: paymentData.trade_no
    }, { 
      where: { payment_no: paymentData.payment_no },
      transaction 
    });
    
    // 2. æ›´æ–°è®¢å•çŠ¶æ€
    await Order.update({
      order_status: 2, // å·²æ”¯ä»˜
      paid_amount: paymentData.amount,
      payment_time: new Date()
    }, { 
      where: { order_id: paymentData.order_id },
      transaction 
    });
    
    // 3. ç”Ÿæˆè¯¾è¡¨è®°å½•
    const scheduleData = await this.generateSchedule(paymentData.order_id);
    await LessonSchedule.create(scheduleData, { transaction });
    
    // 4. æ‰£å‡åº“å­˜ï¼ˆå¦‚æœæ˜¯è¯¾æ—¶åŒ…ï¼‰
    if (paymentData.product_type === 2) {
      await this.deductPackageStock(paymentData.product_id, paymentData.quantity, transaction);
    }
    
    // 5. è®°å½•æ”¯ä»˜æµæ°´
    await PaymentFlow.create({
      payment_id: paymentData.payment_id,
      flow_type: 3, // æ”¯ä»˜æˆåŠŸ
      flow_amount: paymentData.amount,
      flow_desc: 'æ”¯ä»˜æˆåŠŸ',
      operator_type: 3 // ç³»ç»Ÿ
    }, { transaction });
    
    await transaction.commit();
    
    // 6. å‘é€å¼‚æ­¥é€šçŸ¥ï¼ˆäº‹åŠ¡å¤–æ‰§è¡Œï¼‰
    await this.sendPaymentSuccessNotification(paymentData);
    
  } catch (error) {
    await transaction.rollback();
    throw error;
  }
}
```

#### 2. é€€æ¬¾æ•°æ®å›æ»š
```javascript
// é€€æ¬¾å¤„ç†é€»è¾‘
async function processRefund(paymentId, refundAmount, reason) {
  const transaction = await sequelize.transaction();
  
  try {
    // 1. è·å–åŸæ”¯ä»˜è®°å½•
    const payment = await PaymentRecord.findByPk(paymentId, { transaction });
    const order = await Order.findByPk(payment.order_id, { transaction });
    
    // 2. è°ƒç”¨å¾®ä¿¡é€€æ¬¾API
    const refundResult = await wechatPay.refund({
      transaction_id: payment.trade_no,
      out_refund_no: `RF${Date.now()}`,
      amount: {
        refund: refundAmount * 100, // åˆ†
        total: payment.payment_amount * 100,
        currency: 'CNY'
      },
      reason: reason
    });
    
    // 3. æ›´æ–°æ”¯ä»˜è®°å½•
    await payment.update({
      refund_status: 2, // é€€æ¬¾æˆåŠŸ
      refund_amount: refundAmount,
      refund_time: new Date(),
      refund_reason: reason
    }, { transaction });
    
    // 4. æ›´æ–°è®¢å•çŠ¶æ€
    await order.update({
      order_status: 5, // å·²é€€æ¬¾
      paid_amount: payment.payment_amount - refundAmount
    }, { transaction });
    
    // 5. å–æ¶ˆç›¸å…³è¯¾è¡¨
    await LessonSchedule.update({
      lesson_status: 4 // å·²å–æ¶ˆ
    }, { 
      where: { booking_id: order.booking_id },
      transaction 
    });
    
    // 6. æ¢å¤åº“å­˜
    if (order.order_type === 2) { // è¯¾æ—¶åŒ…
      await this.restorePackageStock(order.product_id, order.quantity, transaction);
    }
    
    // 7. è®°å½•é€€æ¬¾æµæ°´
    await PaymentFlow.create({
      payment_id: paymentId,
      flow_type: 6, // é€€æ¬¾æˆåŠŸ
      flow_amount: refundAmount,
      flow_desc: `é€€æ¬¾: ${reason}`,
      operator_type: 2 // ç®¡ç†å‘˜
    }, { transaction });
    
    await transaction.commit();
    
    // 8. å‘é€é€€æ¬¾é€šçŸ¥
    await this.sendRefundNotification(payment, refundAmount);
    
  } catch (error) {
    await transaction.rollback();
    throw error;
  }
}
```

### è¯¾è¡¨è‡ªåŠ¨ç”Ÿæˆç®—æ³•

#### 1. æ™ºèƒ½æ’è¯¾ç®—æ³•
```javascript
// æ™ºèƒ½è¯¾è¡¨ç”Ÿæˆ
class ScheduleGenerator {
  async generateOptimalSchedule(orderData) {
    const { product_id, preferred_time, coach_id, member_id } = orderData;
    
    // 1. è·å–å•†å“ä¿¡æ¯
    const product = await this.getProductWithConfig(product_id);
    
    // 2. è·å–å¯ç”¨æ—¶é—´æ®µ
    const availableSlots = await this.getAvailableTimeSlots(
      preferred_time.date, 
      product.duration_minutes
    );
    
    // 3. è·å–æ•™ç»ƒå¯ç”¨æ€§
    const coachAvailability = await this.getCoachAvailability(
      coach_id, 
      preferred_time.date
    );
    
    // 4. è·å–é©¬åŒ¹å¯ç”¨æ€§
    const horseAvailability = await this.getHorseAvailability(
      preferred_time.date
    );
    
    // 5. æ™ºèƒ½åŒ¹é…æœ€ä½³æ—¶æ®µ
    const optimalSlot = this.findOptimalSlot({
      availableSlots,
      coachAvailability,
      horseAvailability,
      preferredTime: preferred_time.time,
      memberHistory: await this.getMemberLessonHistory(member_id)
    });
    
    // 6. ç”Ÿæˆè¯¾è¡¨è®°å½•
    return {
      schedule_no: this.generateScheduleNo(),
      booking_id: orderData.booking_id,
      club_id: orderData.club_id,
      member_id: member_id,
      coach_id: coach_id,
      horse_id: optimalSlot.horse_id,
      lesson_date: optimalSlot.date,
      start_time: optimalSlot.start_time,
      end_time: optimalSlot.end_time,
      lesson_status: 1, // å¾…ç¡®è®¤
      notification_sent: 0,
      reminder_sent: 0
    };
  }
  
  findOptimalSlot(params) {
    const { availableSlots, coachAvailability, horseAvailability, preferredTime, memberHistory } = params;
    
    // è¯„åˆ†ç®—æ³•
    const scoredSlots = availableSlots.map(slot => {
      let score = 0;
      
      // æ—¶é—´åå¥½è¯„åˆ†ï¼ˆè¶Šæ¥è¿‘æœŸæœ›æ—¶é—´åˆ†æ•°è¶Šé«˜ï¼‰
      const timeDiff = Math.abs(this.getTimeDiff(slot.start_time, preferredTime));
      score += Math.max(0, 100 - timeDiff * 10);
      
      // æ•™ç»ƒå¯ç”¨æ€§è¯„åˆ†
      if (coachAvailability.includes(slot.start_time)) {
        score += 50;
      }
      
      // é©¬åŒ¹åŒ¹é…è¯„åˆ†ï¼ˆæ ¹æ®ä¼šå‘˜å†å²åå¥½ï¼‰
      const preferredHorse = this.getMemberPreferredHorse(memberHistory);
      if (slot.horse_id === preferredHorse) {
        score += 30;
      }
      
      // è¿ç»­è¯¾ç¨‹å¥–åŠ±ï¼ˆå¦‚æœä¼šå‘˜æœ‰è¿ç»­ä¸Šè¯¾ä¹ æƒ¯ï¼‰
      if (this.isConsecutiveLesson(slot, memberHistory)) {
        score += 20;
      }
      
      return { ...slot, score };
    });
    
    // è¿”å›è¯„åˆ†æœ€é«˜çš„æ—¶æ®µ
    return scoredSlots.sort((a, b) => b.score - a.score)[0];
  }
}
```

### å°ç¨‹åºä¸åå°æ•°æ®åŒæ­¥

#### 1. WebSocketå®æ—¶é€šä¿¡
```javascript
// WebSocketæœåŠ¡è®¾è®¡
class ScheduleWebSocketService {
  constructor() {
    this.connections = new Map(); // clubId -> Set<connection>
  }
  
  // å»ºç«‹è¿æ¥
  onConnection(ws, clubId, userType) {
    if (!this.connections.has(clubId)) {
      this.connections.set(clubId, new Set());
    }
    
    ws.clubId = clubId;
    ws.userType = userType; // 'admin' | 'miniapp'
    this.connections.get(clubId).add(ws);
    
    ws.on('close', () => {
      this.connections.get(clubId).delete(ws);
    });
  }
  
  // å¹¿æ’­è¯¾è¡¨æ›´æ–°
  broadcastScheduleUpdate(clubId, updateData) {
    const connections = this.connections.get(clubId);
    if (connections) {
      connections.forEach(ws => {
        if (ws.readyState === WebSocket.OPEN) {
          ws.send(JSON.stringify({
            type: 'schedule_update',
            data: updateData,
            timestamp: Date.now()
          }));
        }
      });
    }
  }
  
  // å‘é€æ”¯ä»˜æˆåŠŸé€šçŸ¥
  notifyPaymentSuccess(clubId, orderData) {
    this.broadcastScheduleUpdate(clubId, {
      type: 'payment_success',
      order: orderData,
      action: 'new_lesson_created'
    });
  }
}
```

#### 2. æ•°æ®ç¼“å­˜ç­–ç•¥
```javascript
// Redisç¼“å­˜ç­–ç•¥
class CacheService {
  constructor() {
    this.redis = new Redis(config.redis);
  }
  
  // è¯¾è¡¨æ•°æ®ç¼“å­˜
  async cacheScheduleData(clubId, date, data) {
    const key = `schedule:${clubId}:${date}`;
    await this.redis.setex(key, 300, JSON.stringify(data)); // 5åˆ†é’Ÿç¼“å­˜
  }
  
  // è·å–ç¼“å­˜çš„è¯¾è¡¨æ•°æ®
  async getCachedSchedule(clubId, date) {
    const key = `schedule:${clubId}:${date}`;
    const cached = await this.redis.get(key);
    return cached ? JSON.parse(cached) : null;
  }
  
  // æ¸…é™¤ç›¸å…³ç¼“å­˜
  async invalidateScheduleCache(clubId, date) {
    const pattern = `schedule:${clubId}:${date}*`;
    const keys = await this.redis.keys(pattern);
    if (keys.length > 0) {
      await this.redis.del(...keys);
    }
  }
  
  // ç”¨æˆ·è¯¾æ—¶åŒ…ç¼“å­˜
  async cacheUserPackages(memberId, packages) {
    const key = `user:packages:${memberId}`;
    await this.redis.setex(key, 600, JSON.stringify(packages)); // 10åˆ†é’Ÿç¼“å­˜
  }
}
```

---

## ğŸ“Š ç³»ç»Ÿç›‘æ§ä¸æ—¥å¿—

### 1. å…³é”®æŒ‡æ ‡ç›‘æ§
```javascript
// ä¸šåŠ¡æŒ‡æ ‡ç›‘æ§
const BusinessMetrics = {
  // æ”¯ä»˜æˆåŠŸç‡
  paymentSuccessRate: {
    metric: 'payment_success_rate',
    calculate: async () => {
      const total = await PaymentRecord.count({
        where: { create_time: { [Op.gte]: dayjs().startOf('day') } }
      });
      const success = await PaymentRecord.count({
        where: { 
          payment_status: 3,
          create_time: { [Op.gte]: dayjs().startOf('day') } 
        }
      });
      return total > 0 ? (success / total * 100).toFixed(2) : 0;
    }
  },
  
  // è¯¾ç¨‹å®Œæˆç‡
  lessonCompletionRate: {
    metric: 'lesson_completion_rate',
    calculate: async () => {
      const total = await LessonSchedule.count({
        where: { lesson_date: { [Op.gte]: dayjs().startOf('day') } }
      });
      const completed = await LessonSchedule.count({
        where: { 
          lesson_status: 5,
          lesson_date: { [Op.gte]: dayjs().startOf('day') } 
        }
      });
      return total > 0 ? (completed / total * 100).toFixed(2) : 0;
    }
  },
  
  // å¹³å‡å“åº”æ—¶é—´
  avgResponseTime: {
    metric: 'avg_response_time',
    calculate: async () => {
      // ä»æ—¥å¿—ä¸­è®¡ç®—APIå¹³å‡å“åº”æ—¶é—´
      return await LogService.getAvgResponseTime();
    }
  }
};
```

### 2. å¼‚å¸¸å¤„ç†ä¸å‘Šè­¦
```javascript
// å¼‚å¸¸å¤„ç†æœåŠ¡
class ExceptionHandler {
  static async handlePaymentException(error, context) {
    // è®°å½•è¯¦ç»†é”™è¯¯æ—¥å¿—
    logger.error('Payment Exception', {
      error: error.message,
      stack: error.stack,
      context: context,
      timestamp: new Date().toISOString()
    });
    
    // å‘é€å‘Šè­¦é€šçŸ¥
    await AlertService.send({
      type: 'payment_error',
      level: 'critical',
      message: `æ”¯ä»˜å¼‚å¸¸: ${error.message}`,
      context: context
    });
    
    // å°è¯•æ•°æ®æ¢å¤
    if (context.order_id) {
      await this.recoverOrderData(context.order_id);
    }
  }
  
  static async handleScheduleConflict(conflictData) {
    logger.warn('Schedule Conflict Detected', conflictData);
    
    // è‡ªåŠ¨è§£å†³å†²çª
    const resolution = await ConflictResolver.resolve(conflictData);
    
    if (!resolution.success) {
      // æ— æ³•è‡ªåŠ¨è§£å†³ï¼Œå‘é€äººå·¥å¹²é¢„é€šçŸ¥
      await AlertService.send({
        type: 'schedule_conflict',
        level: 'warning',
        message: 'è¯¾è¡¨å†²çªéœ€è¦äººå·¥å¤„ç†',
        data: conflictData
      });
    }
  }
}
```

---

## ğŸš€ éƒ¨ç½²ä¸è¿ç»´

### 1. ç¯å¢ƒé…ç½®
```yaml
# docker-compose.yml
version: '3.8'
services:
  app:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - DB_HOST=mysql
      - REDIS_HOST=redis
    depends_on:
      - mysql
      - redis

  mysql:
    image: mysql:8.0
    environment:
      MYSQL_ROOT_PASSWORD: password
      MYSQL_DATABASE: equestrian_club
    volumes:
      - mysql_data:/var/lib/mysql
      - ./sql:/docker-entrypoint-initdb.d

  redis:
    image: redis:6.2-alpine
    volumes:
      - redis_data:/data

  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - app

volumes:
  mysql_data:
  redis_data:
```

### 2. CI/CDæµæ°´çº¿
```yaml
# .github/workflows/deploy.yml
name: Deploy to Production

on:
  push:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Run Tests
        run: |
          npm install
          npm run test
          npm run test:e2e

  build:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build Docker Image
        run: |
          docker build -t equestrian-club:${{ github.sha }} .
          docker tag equestrian-club:${{ github.sha }} equestrian-club:latest

  deploy:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - name: Deploy to Server
        run: |
          # éƒ¨ç½²è„šæœ¬
          ssh user@server 'docker-compose pull && docker-compose up -d'
```

---

## ğŸ“‹ æ€»ç»“

### ğŸ¯ æ ¸å¿ƒç‰¹æ€§æ€»ç»“
1. **åŒç«¯æ¶æ„**: åå°ç®¡ç†ç³»ç»Ÿ + å¾®ä¿¡å°ç¨‹åºï¼Œæ•°æ®å®æ—¶åŒæ­¥
2. **æ™ºèƒ½æ’è¯¾**: è®¢å•ç”Ÿæˆå³åˆ›å»ºè¯¾è¡¨ï¼Œæ”¯æŒå†²çªæ£€æµ‹å’Œè‡ªåŠ¨ä¼˜åŒ–
3. **å®Œæ•´æ”¯ä»˜**: å¾®ä¿¡æ”¯ä»˜é›†æˆï¼Œæ”¯æŒé€€æ¬¾å’Œæ•°æ®å›æ»š
4. **åŠ¨æ€è¡¨å•**: æ ¹æ®å•†å“ç±»å‹è‡ªåŠ¨åˆ‡æ¢é…ç½®è¡¨å•
5. **å®æ—¶é€šä¿¡**: WebSocketå®ç°å¤šç”¨æˆ·å®æ—¶è¯¾è¡¨æ›´æ–°

### ğŸ“Š æŠ€æœ¯ä¼˜åŠ¿
- **é«˜å¯ç”¨æ€§**: åˆ†å¸ƒå¼æ¶æ„ï¼ŒRedisç¼“å­˜ï¼Œæ•°æ®åº“ä¸»ä»
- **æ•°æ®ä¸€è‡´æ€§**: åˆ†å¸ƒå¼äº‹åŠ¡ï¼Œå¹‚ç­‰æ€§æ§åˆ¶
- **å®‰å…¨å¯é **: æ”¯ä»˜ç­¾åéªŒè¯ï¼Œæ•°æ®åŠ å¯†ä¼ è¾“
- **æ€§èƒ½ä¼˜åŒ–**: ç´¢å¼•ä¼˜åŒ–ï¼Œç¼“å­˜ç­–ç•¥ï¼Œæ‡’åŠ è½½

### ğŸ”® æ‰©å±•æ€§è®¾è®¡
- **å¾®æœåŠ¡æ¶æ„**: æ¨¡å—åŒ–è®¾è®¡ï¼Œä¾¿äºåç»­æ‹†åˆ†
- **æ’ä»¶åŒ–æ”¯ä»˜**: æ”¯æŒå¤šç§æ”¯ä»˜æ–¹å¼æ‰©å±•
- **å¤šç§Ÿæˆ·æ”¯æŒ**: ä¸ºè¿é”ä¿±ä¹éƒ¨æä¾›æ‰©å±•åŸºç¡€
- **æ•°æ®åˆ†æ**: å®Œæ•´çš„æ•°æ®åŸ‹ç‚¹ï¼Œæ”¯æŒæ·±åº¦åˆ†æ

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.0  
**æ›´æ–°æ—¶é—´**: 2024-08-15  
**è®¾è®¡çŠ¶æ€**: å¾…å¼€å‘å®ç°