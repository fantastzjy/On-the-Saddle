<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.lab1024.sa.admin.module.business.horse.dao.HorseHealthRecordDao">

    <select id="queryByPage" resultType="net.lab1024.sa.admin.module.business.horse.domain.vo.HorseHealthRecordListVO">
        SELECT
            hr.id,
            hr.horse_id,
            h.horse_name,
            h.horse_code,
            c.club_name,
            hr.plan_id,
            hp.plan_name,
            hr.record_type,
            hr.record_date,
            hr.executor_id,
            executor.actual_name as executor_name,
            hr.content,
            hr.img_url,
            hr.next_date,
            hr.create_time,
            hr.create_by
        FROM m_horse_health_record hr
        LEFT JOIN m_horse h ON hr.horse_id = h.horse_id AND h.is_delete = 0 AND h.is_valid = 1
        LEFT JOIN m_club c ON h.club_id = c.club_id AND c.is_delete = 0 AND c.is_valid = 1
        LEFT JOIN m_horse_health_plan hp ON hr.plan_id = hp.id AND hp.is_delete = 0 AND hp.is_valid = 1
        LEFT JOIN t_employee executor ON hr.executor_id = executor.employee_id AND executor.deleted_flag = 0
        <where>
            hr.is_delete = #{query.isDelete} AND hr.is_valid = #{query.isValid}
            <if test="query.horseId != null">
                AND hr.horse_id = #{query.horseId}
            </if>
            <if test="query.planId != null">
                AND hr.plan_id = #{query.planId}
            </if>
            <if test="query.recordType != null and query.recordType != ''">
                AND hr.record_type = #{query.recordType}
            </if>
            <if test="query.executorId != null">
                AND hr.executor_id = #{query.executorId}
            </if>
            <if test="query.recordDateStart != null">
                AND hr.record_date >= #{query.recordDateStart}
            </if>
            <if test="query.recordDateEnd != null">
                AND hr.record_date &lt;= #{query.recordDateEnd}
            </if>
        </where>
        ORDER BY hr.record_date DESC, hr.create_time DESC
    </select>

    <select id="queryByHorseId" resultType="net.lab1024.sa.admin.module.business.horse.domain.vo.HorseHealthRecordListVO">
        SELECT
            hr.id,
            hr.horse_id,
            h.horse_name,
            h.horse_code,
            c.club_name,
            hr.plan_id,
            hp.plan_name,
            hr.record_type,
            hr.record_date,
            hr.executor_id,
            executor.actual_name as executor_name,
            hr.content,
            hr.img_url,
            hr.next_date,
            hr.create_time,
            hr.create_by
        FROM m_horse_health_record hr
        LEFT JOIN m_horse h ON hr.horse_id = h.horse_id AND h.is_delete = 0 AND h.is_valid = 1
        LEFT JOIN m_club c ON h.club_id = c.club_id AND c.is_delete = 0 AND c.is_valid = 1
        LEFT JOIN m_horse_health_plan hp ON hr.plan_id = hp.id AND hp.is_delete = 0 AND hp.is_valid = 1
        LEFT JOIN t_employee executor ON hr.executor_id = executor.employee_id AND executor.deleted_flag = 0
        WHERE hr.horse_id = #{horseId} AND hr.is_delete = 0 AND hr.is_valid = 1
        ORDER BY hr.record_date DESC
    </select>

    <select id="queryByPlanId" resultType="net.lab1024.sa.admin.module.business.horse.domain.vo.HorseHealthRecordListVO">
        SELECT
            hr.id,
            hr.horse_id,
            h.horse_name,
            h.horse_code,
            c.club_name,
            hr.plan_id,
            hp.plan_name,
            hr.record_type,
            hr.record_date,
            hr.executor_id,
            executor.actual_name as executor_name,
            hr.content,
            hr.img_url,
            hr.next_date,
            hr.create_time,
            hr.create_by
        FROM m_horse_health_record hr
        LEFT JOIN m_horse h ON hr.horse_id = h.horse_id AND h.is_delete = 0 AND h.is_valid = 1
        LEFT JOIN m_club c ON h.club_id = c.club_id AND c.is_delete = 0 AND c.is_valid = 1
        LEFT JOIN m_horse_health_plan hp ON hr.plan_id = hp.id AND hp.is_delete = 0 AND hp.is_valid = 1
        LEFT JOIN t_employee executor ON hr.executor_id = executor.employee_id AND executor.deleted_flag = 0
        WHERE hr.plan_id = #{planId} AND hr.is_delete = 0 AND hr.is_valid = 1
        ORDER BY hr.record_date DESC
    </select>

</mapper>