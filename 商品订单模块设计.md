# 商品订单模块数据库设计

## 一、商品模块表结构设计

### 1. 商品基础表 (m_product)

```sql
CREATE TABLE m_product
(
    product_id   BIGINT AUTO_INCREMENT COMMENT '商品ID' PRIMARY KEY,
    club_id      BIGINT                                NOT NULL COMMENT '俱乐部ID',
    product_name VARCHAR(100)                          NOT NULL COMMENT '商品名称',
    product_code VARCHAR(50) DEFAULT ''                NOT NULL COMMENT '商品编码',
    product_type TINYINT                               NOT NULL COMMENT '商品类型: 1-课程 2-课时包 3-活动',
    sub_type     VARCHAR(50) DEFAULT ''                NOT NULL COMMENT '商品子类型',
    description  TEXT                                  NOT NULL COMMENT '商品描述',
    images       TEXT                                  NOT NULL COMMENT '商品图片地址列表JSON格式',
    status       TINYINT     DEFAULT 1                 NOT NULL COMMENT '商品状态: 1-上架 2-下架 3-售罄',
    sort_order   INT         DEFAULT 0                 NOT NULL COMMENT '排序',
    create_by    VARCHAR(50) DEFAULT ''                NOT NULL COMMENT '创建人',
    create_time  DATETIME    DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    update_by    VARCHAR(50) DEFAULT ''                NOT NULL COMMENT '更新人',
    update_time  DATETIME    DEFAULT CURRENT_TIMESTAMP NOT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_valid     INT         DEFAULT 1                 NOT NULL COMMENT '是否有效;1=有效;0=无效;',
    is_delete    INT         DEFAULT 0                 NOT NULL COMMENT '是否删除;1=已删除;0=未删除;',
    CONSTRAINT uk_product_code UNIQUE (club_id, product_code)
) COMMENT '商品基础表';

CREATE INDEX idx_club_id ON m_product (club_id);
CREATE INDEX idx_product_type ON m_product (product_type);
CREATE INDEX idx_status ON m_product (status);
CREATE INDEX idx_is_delete ON m_product (is_delete);
```

### 2. 课程商品表 (m_product_course)

```sql
CREATE TABLE m_product_course
(
    id               BIGINT AUTO_INCREMENT COMMENT '主键ID' PRIMARY KEY,
    product_id       BIGINT                                   NOT NULL COMMENT '商品ID',
    course_type      VARCHAR(20)                              NOT NULL COMMENT '课程类型: experience-体验课,basic-基础课,advanced-进阶课,senior-高级课,master-大师课,horse_owner-马主课,theory-理论课,group-小组课',
    duration_minutes INT            DEFAULT 0                 NOT NULL COMMENT '时长（分钟）',
    duration_periods DECIMAL(4, 1)  DEFAULT 0.0               NOT NULL COMMENT '时长（鞍时）',
    max_students     INT            DEFAULT 1                 NOT NULL COMMENT '最大人数',
    base_price       DECIMAL(10, 2) DEFAULT 0.00              NOT NULL COMMENT '基础单价',
    coach_fee        DECIMAL(10, 2) DEFAULT 0.00              NOT NULL COMMENT '教练费',
    horse_fee        DECIMAL(10, 2) DEFAULT 0.00              NOT NULL COMMENT '马匹费用',
    -- 小组课特殊配置
    group_config     TEXT COMMENT '小组课配置JSON: {coaches: [{coach_id, prices: {2: price, 3: price, 4: price, 5: price}}]}',
    create_by        VARCHAR(50)    DEFAULT ''                NOT NULL COMMENT '创建人',
    create_time      DATETIME       DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    update_by        VARCHAR(50)    DEFAULT ''                NOT NULL COMMENT '更新人',
    update_time      DATETIME       DEFAULT CURRENT_TIMESTAMP NOT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    CONSTRAINT uk_product_id UNIQUE (product_id)
) COMMENT '课程商品表';

CREATE INDEX idx_course_type ON m_product_course (course_type);
```

### 3. 课时包商品表 (m_product_package)

```sql
CREATE TABLE m_product_package
(
    id                BIGINT AUTO_INCREMENT COMMENT '主键ID' PRIMARY KEY,
    product_id        BIGINT                                NOT NULL COMMENT '商品ID',
    package_type      VARCHAR(20) DEFAULT ''                NOT NULL COMMENT '课包类型',
    details           TEXT                                  NOT NULL COMMENT '课包详情',
    price             DECIMAL(10, 2)                        NOT NULL COMMENT '课包单价',
    total_sessions    INT         DEFAULT 0                 NOT NULL COMMENT '总课时数',
    validity_days     INT         DEFAULT 365               NOT NULL COMMENT '有效期（天）',
    binding_member_id BIGINT      DEFAULT 0 COMMENT '绑定会员ID（0表示不绑定）',
    binding_coach_id  BIGINT      DEFAULT 0 COMMENT '绑定教练ID（0表示不绑定）',
    stock_quantity    INT         DEFAULT 0                 NOT NULL COMMENT '库存数量',
    create_by         VARCHAR(50) DEFAULT ''                NOT NULL COMMENT '创建人',
    create_time       DATETIME    DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    update_by         VARCHAR(50) DEFAULT ''                NOT NULL COMMENT '更新人',
    update_time       DATETIME    DEFAULT CURRENT_TIMESTAMP NOT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    CONSTRAINT uk_product_id UNIQUE (product_id)
) COMMENT '课时包商品表';

CREATE INDEX idx_binding_member_id ON m_product_package (binding_member_id);
CREATE INDEX idx_binding_coach_id ON m_product_package (binding_coach_id);
```

### 4. 活动商品表 (m_product_activity)

```sql
CREATE TABLE m_product_activity
(
    id                   BIGINT AUTO_INCREMENT COMMENT '主键ID' PRIMARY KEY,
    product_id           BIGINT                                 NOT NULL COMMENT '商品ID',
    activity_name        VARCHAR(50)                            NOT NULL COMMENT '活动名称（最多5个字）',
    activity_details     TEXT                                   NOT NULL COMMENT '活动详情全文介绍',
    activity_time        DATETIME COMMENT '活动时间',
    activity_location    VARCHAR(200) DEFAULT '' COMMENT '活动地点',
    price                DECIMAL(10, 2)                         NOT NULL COMMENT '活动单价',
    max_participants     INT                                    NOT NULL COMMENT '最大参与人数',
    current_participants INT          DEFAULT 0                 NOT NULL COMMENT '当前参与人数',
    refund_rule          TEXT                                   NOT NULL COMMENT '退款规则',
    detail_images        TEXT                                   NOT NULL COMMENT '详情图片地址列表JSON格式（最多9张）',
    create_by            VARCHAR(50)  DEFAULT ''                NOT NULL COMMENT '创建人',
    create_time          DATETIME     DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    update_by            VARCHAR(50)  DEFAULT ''                NOT NULL COMMENT '更新人',
    update_time          DATETIME     DEFAULT CURRENT_TIMESTAMP NOT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    CONSTRAINT uk_product_id UNIQUE (product_id)
) COMMENT '活动商品表';

CREATE INDEX idx_activity_time ON m_product_activity (activity_time);
```

### 5. 商品教练关联表 (m_product_coach)

```sql
CREATE TABLE m_product_coach
(
    id          BIGINT AUTO_INCREMENT COMMENT '主键ID' PRIMARY KEY,
    product_id  BIGINT                                NOT NULL COMMENT '商品ID',
    coach_id    BIGINT                                NOT NULL COMMENT '教练ID',
    is_default  TINYINT     DEFAULT 0                 NOT NULL COMMENT '是否默认教练: 1-是 0-否',
    create_by   VARCHAR(50) DEFAULT ''                NOT NULL COMMENT '创建人',
    create_time DATETIME    DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    CONSTRAINT uk_product_coach UNIQUE (product_id, coach_id)
) COMMENT '商品教练关联表';

CREATE INDEX idx_product_id ON m_product_coach (product_id);
CREATE INDEX idx_coach_id ON m_product_coach (coach_id);
```

## 二、订单模块表结构设计

### 1. 订单主表 (m_order)

```sql
CREATE TABLE m_order
(
    order_id       BIGINT AUTO_INCREMENT COMMENT '订单ID' PRIMARY KEY,
    order_no       VARCHAR(50)                              NOT NULL COMMENT '订单号',
    club_id        BIGINT                                   NOT NULL COMMENT '俱乐部ID',
    member_id      BIGINT                                   NOT NULL COMMENT '会员ID',
    order_type     TINYINT                                  NOT NULL COMMENT '订单类型: 1-课程 2-课时包 3-活动',
    order_status   TINYINT        DEFAULT 1                 NOT NULL COMMENT '订单状态: 1-待支付 2-已支付 3-已完成 4-已取消 5-已退款',
    total_amount   DECIMAL(10, 2)                           NOT NULL COMMENT '订单总金额',
    paid_amount    DECIMAL(10, 2) DEFAULT 0.00              NOT NULL COMMENT '已支付金额',
    payment_method VARCHAR(50)    DEFAULT '' COMMENT '支付方式',
    payment_time   DATETIME NULL COMMENT '支付时间',
    remark         VARCHAR(500)   DEFAULT '' COMMENT '订单备注',
    create_by      VARCHAR(50)    DEFAULT ''                NOT NULL COMMENT '创建人',
    create_time    DATETIME       DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    update_by      VARCHAR(50)    DEFAULT ''                NOT NULL COMMENT '更新人',
    update_time    DATETIME       DEFAULT CURRENT_TIMESTAMP NOT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    is_valid       INT            DEFAULT 1                 NOT NULL COMMENT '是否有效;1=有效;0=无效;',
    is_delete      INT            DEFAULT 0                 NOT NULL COMMENT '是否删除;1=已删除;0=未删除;',
    CONSTRAINT uk_order_no UNIQUE (order_no)
) COMMENT '订单主表';

CREATE INDEX idx_club_id ON m_order (club_id);
CREATE INDEX idx_member_id ON m_order (member_id);
CREATE INDEX idx_order_status ON m_order (order_status);
CREATE INDEX idx_create_time ON m_order (create_time);
CREATE INDEX idx_is_delete ON m_order (is_delete);
```

### 2. 订单明细表 (m_order_item)

```sql
CREATE TABLE m_order_item
(
    id           BIGINT AUTO_INCREMENT COMMENT '主键ID' PRIMARY KEY,
    order_id     BIGINT                             NOT NULL COMMENT '订单ID',
    product_id   BIGINT                             NOT NULL COMMENT '商品ID',
    product_name VARCHAR(100)                       NOT NULL COMMENT '商品名称',
    product_type TINYINT                            NOT NULL COMMENT '商品类型: 1-课程 2-课时包 3-活动',
    quantity     INT      DEFAULT 1                 NOT NULL COMMENT '数量',
    unit_price   DECIMAL(10, 2)                     NOT NULL COMMENT '单价',
    total_price  DECIMAL(10, 2)                     NOT NULL COMMENT '小计',
    coach_id     BIGINT   DEFAULT 0 COMMENT '关联教练ID',
    item_config  TEXT COMMENT '商品配置JSON格式',
    create_time  DATETIME DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间'
) COMMENT '订单明细表';

CREATE INDEX idx_order_id ON m_order_item (order_id);
CREATE INDEX idx_product_id ON m_order_item (product_id);
```

### 3. 预约/约课表 (m_booking)

```sql
CREATE TABLE m_booking
(
    booking_id       BIGINT AUTO_INCREMENT COMMENT '预约ID' PRIMARY KEY,
    order_id         BIGINT                                 NOT NULL COMMENT '订单ID',
    order_item_id    BIGINT                                 NOT NULL COMMENT '订单明细ID',
    club_id          BIGINT                                 NOT NULL COMMENT '俱乐部ID',
    member_id        BIGINT                                 NOT NULL COMMENT '会员ID',
    product_id       BIGINT                                 NOT NULL COMMENT '商品ID',
    coach_id         BIGINT       DEFAULT 0 COMMENT '教练ID',
    horse_id         BIGINT       DEFAULT 0 COMMENT '马匹ID',
    booking_date     DATE                                   NOT NULL COMMENT '预约日期',
    booking_time     TIME                                   NOT NULL COMMENT '预约时间',
    duration_minutes INT                                    NOT NULL COMMENT '时长（分钟）',
    booking_status   TINYINT      DEFAULT 1                 NOT NULL COMMENT '预约状态: 1-待确认 2-已确认 3-已完成 4-已取消',
    cancel_reason    VARCHAR(500) DEFAULT '' COMMENT '取消原因',
    create_by        VARCHAR(50)  DEFAULT ''                NOT NULL COMMENT '创建人',
    create_time      DATETIME     DEFAULT CURRENT_TIMESTAMP NOT NULL COMMENT '创建时间',
    update_by        VARCHAR(50)  DEFAULT ''                NOT NULL COMMENT '更新人',
    update_time      DATETIME     DEFAULT CURRENT_TIMESTAMP NOT NULL ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间'
) COMMENT '预约/约课表';

CREATE INDEX idx_order_id ON m_booking (order_id);
CREATE INDEX idx_member_id ON m_booking (member_id);
CREATE INDEX idx_booking_date ON m_booking (booking_date);
CREATE INDEX idx_coach_id ON m_booking (coach_id);
```

## 三、商品列表页面设计

### 页面布局

```
┌─────────────────────────────────────────────────────────────────┐
│ 商品管理                                              [+ 新增商品] │
├─────────────────────────────────────────────────────────────────┤
│ 筛选条件：                                                      │
│ [商品类型▼] [状态▼] [创建时间范围] [商品名称搜索框] [搜索] [重置] │
├─────────────────────────────────────────────────────────────────┤
│ 商品列表 (表格形式):                                            │
│ ┌─────┬────────┬──────┬──────┬──────┬──────┬──────┬────────┐     │
│ │选择 │商品编码 │商品名称│商品类型│状态  │价格  │库存  │操作    │     │
│ ├─────┼────────┼──────┼──────┼──────┼──────┼──────┼────────┤     │
│ │ □   │P001   │体验课  │课程  │上架  │200  │--   │编辑|下架│     │
│ │ □   │P002   │课包1  │课时包│上架  │2000 │50   │编辑|下架│     │
│ │ □   │P003   │骑术活动│活动  │下架  │300  │20/30│编辑|上架│     │
│ └─────┴────────┴──────┴──────┴──────┴──────┴──────┴────────┘     │
│                                                                 │
│ [批量上架] [批量下架] [批量删除]              第1页/共10页 [翻页] │
└─────────────────────────────────────────────────────────────────┘
```

### 功能特点

1. **筛选功能**：按商品类型、状态、时间范围、名称搜索
2. **批量操作**：批量上架、下架、删除
3. **状态标识**：直观显示商品状态（上架/下架/售罄）
4. **快速操作**：表格内直接编辑、上架/下架切换

## 四、新增商品页面设计

### 页面布局 (分步骤表单)

```
┌─────────────────────────────────────────────────────────────────┐
│ 新增商品                                              [保存] [取消] │
├─────────────────────────────────────────────────────────────────┤
│ 步骤: ① 选择类型 → ② 基础信息 → ③ 详细配置 → ④ 确认发布           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ 第一步：选择商品类型                                            │
│                                                                 │
│ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐     │
│ │      课程        │ │     课时包       │ │      活动        │     │
│ │  [课程图标]      │ │  [课包图标]      │ │  [活动图标]      │     │
│ │ 体验课、基础课... │ │ 课包1-7等...    │ │ 自定义活动...    │     │
│ │                 │ │                 │ │                 │     │
│ │    [选择]        │ │    [选择]        │ │    [选择]        │     │
│ └─────────────────┘ └─────────────────┘ └─────────────────┘     │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 课程类型配置页面

```
┌─────────────────────────────────────────────────────────────────┐
│ 新增课程                                                        │
├─────────────────────────────────────────────────────────────────┤
│ 基础信息:                                                       │
│ 商品名称: [_________________] 商品编码: [__________]             │
│ 课程类型: [体验课▼]                                            │
│ 商品描述: [____________________]                               │
│ 商品图片: [上传图片] [预览图片]                                 │
│                                                                 │
│ 课程配置:                                                       │
│ 时长: [___] 分钟  鞍时: [___] 人数: [___]                      │
│ 教练费: [_____] 马匹费: [_____] 单价: [_____] (自动计算)        │
│                                                                 │
│ 教练设置:                                                       │
│ 可选教练: □ 李教练(ID:001) □ 王教练(ID:002) □ 张教练(ID:003)    │
│                                                                 │
│ 特殊配置 (小组课):                                              │
│ ┌──────────────────────────────────────────────────────────┐     │
│ │教练: [李教练▼]                                           │     │
│ │2人: [___] 3人: [___] 4人: [___] 5人: [___]              │     │
│ │[+ 添加教练配置]                                         │     │
│ └──────────────────────────────────────────────────────────┘     │
│                                                                 │
│                                          [上一步] [下一步]      │
└─────────────────────────────────────────────────────────────────┘
```

### 课时包配置页面

```
┌─────────────────────────────────────────────────────────────────┐
│ 新增课时包                                                      │
├─────────────────────────────────────────────────────────────────┤
│ 基础信息:                                                       │
│ 商品名称: [_________________] 商品编码: [__________]             │
│ 课包类型: [课包1▼]                                             │
│ 商品描述: [____________________]                               │
│                                                                 │
│ 课包配置:                                                       │
│ 课包详情: [_________________________________]                  │
│ 单价: [_______] 总课时数: [____] 有效期: [___] 天               │
│ 库存数量: [____]                                               │
│                                                                 │
│ 绑定设置:                                                       │
│ 绑定客户: [请选择客户▼] 绑定教练: [请选择教练▼]                │
│                                                                 │
│                                          [上一步] [下一步]      │
└─────────────────────────────────────────────────────────────────┘
```

### 活动配置页面

```
┌─────────────────────────────────────────────────────────────────┐
│ 新增活动                                                        │
├─────────────────────────────────────────────────────────────────┤
│ 基础信息:                                                       │
│ 活动名称: [____] (最多5个字)  活动编码: [__________]             │
│                                                                 │
│ 活动详情:                                                       │
│ 全文介绍: [_________________________________]                  │
│ 活动时间: [日期时间选择器]                                      │
│ 活动地点: [_________________________________]                  │
│                                                                 │
│ 价格设置:                                                       │
│ 单价: [_______] 最大人数: [____]                               │
│                                                                 │
│ 退款规则:                                                       │
│ [_________________________________]                           │
│ 例如：活动开始前3小时不可退款                                   │
│                                                                 │
│ 详情图片: (最多9张)                                             │
│ [上传图片1] [上传图片2] [上传图片3] [+]                         │
│                                                                 │
│                                          [上一步] [下一步]      │
└─────────────────────────────────────────────────────────────────┘
```

## 五、关键设计考虑

### 1. 数据一致性

- 商品与教练、会员的关联通过独立关联表管理
- 订单创建时快照商品信息，避免商品变更影响历史订单
- 库存管理通过触发器或应用层面控制

### 2. 扩展性设计

- 商品扩展信息通过JSON字段存储，便于新增字段
- 价格策略支持复杂配置（如小组课不同人数不同价格）
- 支持未来新增商品类型

### 3. 业务逻辑

- 课时包消费时从库存扣减，支持过期处理
- 活动支持库存管理和人数限制
- 订单状态流转支持取消、退款等场景

### 4. 用户体验

- 分步骤表单降低操作复杂度
- 动态表单根据选择的商品类型显示不同字段
- 实时预览和验证提升录入效率
